{"version":3,"file":"endless-scroll.js","sources":["../src/endless-scroll.js"],"sourcesContent":["import { root } from 'postcss';\nimport { fetchedData } from './js/pixabay-api';\nimport { createGalleryMarkup } from './js/render-functions';\nimport iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\n\nconst form = document.querySelector('form');\nconst input = document.querySelector('input');\nconst loaderFirst = document.querySelector('.first');\nconst loaderSecond = document.querySelector('.second');\nconst gallery = document.querySelector('.gallery');\nconst observeredElement = document.querySelector('.observered-element');\n\nlet currentPage = 1;\nconst perPage = 15;\nlet searchedValue = '';\n\nconst observerOptions = {\n  root: null,\n  rootMargin: '0px 0px 300px 0px',\n  threshold: 1,\n};\n\nconst observerCallBack = async entries => {\n  if (entries[0].isIntersecting) {\n    try {\n      currentPage++;\n      loaderSecond.classList.remove('is-hidden');\n  \n      const response = await fetchedData(searchedValue, currentPage);\n  \n      const galleryMarkup = response.data.hits.map(createGalleryMarkup).join('');\n      gallery.insertAdjacentHTML('beforeend', galleryMarkup);\n    \n      galleryLibrary.refresh();\n  \n      const totalResults = response.data.total;\n      const totalPages = Math.ceil(totalResults / perPage);\n  \n      if (currentPage > totalPages) {\n        observer.unobserve(observeredElement);\n\n        return iziToast.error({\n          message:\n            'We are sorry, but you have reached the end of search results!',\n          position: 'center',\n        });\n      }\n    } catch (err) {\n      iziToast.error({\n        message: `${err}`,\n        position: 'center',\n      });\n    } finally {\n      loaderSecond.classList.add('is-hidden');\n    }\n  }\n};\n\nconst observer = new IntersectionObserver(observerCallBack, observerOptions);\n\nconst onFormSubmit = async event => {\n  try {\n    event.preventDefault();\n\n    searchedValue = input.value.trim();\n\n    currentPage = 1;\n\n    if (!searchedValue) {\n      iziToast.error({\n        message: 'Please enter a search query!',\n        position: 'topRight',\n      });\n      return;\n    }\n\n    loaderFirst.classList.remove('is-hidden');\n\n    const response = await fetchedData(searchedValue, currentPage);\n\n    gallery.innerHTML = '';\n\n    if (response.data.hits.length === 0) {\n      iziToast.error({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n\n      form.reset();\n      return;\n    }\n\n    const galleryMarkup = response.data.hits.map(createGalleryMarkup).join('');\n    gallery.innerHTML = galleryMarkup;\n\n    galleryLibrary.refresh();\n\n    observer.observe(observeredElement);\n  } catch (err) {\n    iziToast.error({\n      message: `${err}`,\n      position: 'center',\n    });\n  } finally {\n    loaderFirst.classList.add('is-hidden');\n    form.reset();\n  }\n};\n\nlet galleryLibrary = new SimpleLightbox('.gallery li a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n  overlayOpacity: 0.8,\n  captionsPosition: 'bottom',\n});\n\nform.addEventListener('submit', onFormSubmit);"],"names":["form","input","loaderFirst","loaderSecond","gallery","observeredElement","currentPage","perPage","searchedValue","observerOptions","observerCallBack","entries","response","fetchedData","galleryMarkup","createGalleryMarkup","galleryLibrary","totalResults","totalPages","observer","iziToast","err","onFormSubmit","event","SimpleLightbox"],"mappings":"wHAMA,MAAMA,EAAO,SAAS,cAAc,MAAM,EACpCC,EAAQ,SAAS,cAAc,OAAO,EACtCC,EAAc,SAAS,cAAc,QAAQ,EAC7CC,EAAe,SAAS,cAAc,SAAS,EAC/CC,EAAU,SAAS,cAAc,UAAU,EAC3CC,EAAoB,SAAS,cAAc,qBAAqB,EAEtE,IAAIC,EAAc,EAClB,MAAMC,EAAU,GAChB,IAAIC,EAAgB,GAEpB,MAAMC,EAAkB,CACtB,KAAM,KACN,WAAY,oBACZ,UAAW,CACb,EAEMC,EAAmB,MAAMC,GAAW,CACxC,GAAIA,EAAQ,CAAC,EAAE,eACb,GAAI,CACFL,IACAH,EAAa,UAAU,OAAO,WAAW,EAEzC,MAAMS,EAAW,MAAMC,EAAYL,EAAeF,CAAW,EAEvDQ,EAAgBF,EAAS,KAAK,KAAK,IAAIG,CAAmB,EAAE,KAAK,EAAE,EACzEX,EAAQ,mBAAmB,YAAaU,CAAa,EAErDE,EAAe,QAAO,EAEtB,MAAMC,EAAeL,EAAS,KAAK,MAC7BM,EAAa,KAAK,KAAKD,EAAeV,CAAO,EAEnD,GAAID,EAAcY,EAChB,OAAAC,EAAS,UAAUd,CAAiB,EAE7Be,EAAS,MAAM,CACpB,QACE,gEACF,SAAU,QACpB,CAAS,CAEJ,OAAQC,EAAK,CACZD,EAAS,MAAM,CACb,QAAS,GAAGC,CAAG,GACf,SAAU,QAClB,CAAO,CACP,QAAc,CACRlB,EAAa,UAAU,IAAI,WAAW,CACvC,CAEL,EAEMgB,EAAW,IAAI,qBAAqBT,EAAkBD,CAAe,EAErEa,EAAe,MAAMC,GAAS,CAClC,GAAI,CAOF,GANAA,EAAM,eAAc,EAEpBf,EAAgBP,EAAM,MAAM,OAE5BK,EAAc,EAEV,CAACE,EAAe,CAClBY,EAAS,MAAM,CACb,QAAS,+BACT,SAAU,UAClB,CAAO,EACD,MACD,CAEDlB,EAAY,UAAU,OAAO,WAAW,EAExC,MAAMU,EAAW,MAAMC,EAAYL,EAAeF,CAAW,EAI7D,GAFAF,EAAQ,UAAY,GAEhBQ,EAAS,KAAK,KAAK,SAAW,EAAG,CACnCQ,EAAS,MAAM,CACb,QACE,2EACF,SAAU,UAClB,CAAO,EAEDpB,EAAK,MAAK,EACV,MACD,CAED,MAAMc,EAAgBF,EAAS,KAAK,KAAK,IAAIG,CAAmB,EAAE,KAAK,EAAE,EACzEX,EAAQ,UAAYU,EAEpBE,EAAe,QAAO,EAEtBG,EAAS,QAAQd,CAAiB,CACnC,OAAQgB,EAAK,CACZD,EAAS,MAAM,CACb,QAAS,GAAGC,CAAG,GACf,SAAU,QAChB,CAAK,CACL,QAAY,CACRnB,EAAY,UAAU,IAAI,WAAW,EACrCF,EAAK,MAAK,CACX,CACH,EAEA,IAAIgB,EAAiB,IAAIQ,EAAe,gBAAiB,CACvD,SAAU,GACV,aAAc,MACd,aAAc,IACd,eAAgB,GAChB,iBAAkB,QACpB,CAAC,EAEDxB,EAAK,iBAAiB,SAAUsB,CAAY"}